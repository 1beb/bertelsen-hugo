<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>@beb</title><link>https://bertelsen.ca/</link><description>Recent content on @beb</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 01 Jan 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://bertelsen.ca/index.xml" rel="self" type="application/rss+xml"/><item><title>Rcpp and roxygem2</title><link>https://bertelsen.ca/post/rcpp-roxygen2/</link><pubDate>Sun, 28 Aug 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/rcpp-roxygen2/</guid><description>
&lt;p>Instructions for using Rcpp and Roxygen2 together. This assumes that Roxygen2 is managing your namespace:&lt;/p>
&lt;p>DESCRIPTION:&lt;/p>
&lt;ul>
&lt;li>In your DESCRIPTION file, add the line &lt;code>LinkingTo: Rcpp&lt;/code>&lt;/li>
&lt;li>Also ensure that you import Rcpp, &lt;code>Imports: Rcpp&lt;/code> along with all the other packages are imported in your namespace.&lt;/li>
&lt;/ul>
&lt;p>Package Documentation:&lt;/p>
&lt;ul>
&lt;li>Your package documentation (by convention in &lt;code>zzz.R&lt;/code> or &lt;code>package.R&lt;/code>) you should have the following:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1">#&amp;#39; your_package&lt;/span>
&lt;span class="c1">#&amp;#39; &lt;/span>
&lt;span class="c1">#&amp;#39; Description of your package&lt;/span>
&lt;span class="c1">#&amp;#39; &lt;/span>
&lt;span class="c1">#&amp;#39; @docType package&lt;/span>
&lt;span class="c1">#&amp;#39; @author you &amp;lt;youremail&amp;gt;&lt;/span>
&lt;span class="c1">#&amp;#39; @import Rcpp another_package another&lt;/span>
&lt;span class="c1">#&amp;#39; @importFrom Rcpp evalCpp&lt;/span>
&lt;span class="c1">#&amp;#39; @useDynLib your_package&lt;/span>
&lt;span class="c1">#&amp;#39; @name your_package&lt;/span>
&lt;span class="kc">NULL&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Functions:&lt;/p>
&lt;ul>
&lt;li>Add &lt;code>*.cpp&lt;/code> files to &lt;code>/src&lt;/code> directory.&lt;/li>
&lt;li>Remember to use &lt;code>//'&lt;/code> as your comment so that Roxygen2 picks it up appropriately.&lt;/li>
&lt;li>Remember to include &lt;code>[[Rcpp:export]]&lt;/code> so that it is picked up by &lt;code>Rcpp::compileAttributes()&lt;/code> when you build and reload or run &lt;code>roxygenize()&lt;/code> manually as per your project options&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;Rcpp.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;span class="cp">&lt;/span>
&lt;span class="k">using&lt;/span> &lt;span class="k">namespace&lt;/span> &lt;span class="n">Rcpp&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="c1">//&amp;#39; Leading NA
&lt;/span>&lt;span class="c1">//&amp;#39;
&lt;/span>&lt;span class="c1">//&amp;#39; This function returns a logical vector identifying if
&lt;/span>&lt;span class="c1">//&amp;#39; there are leading NA, marking the leadings NA as TRUE and
&lt;/span>&lt;span class="c1">//&amp;#39; everything else as FALSE.
&lt;/span>&lt;span class="c1">//&amp;#39;
&lt;/span>&lt;span class="c1">//&amp;#39; @param x An integer vector
&lt;/span>&lt;span class="c1">//&amp;#39; @export
&lt;/span>&lt;span class="c1">// [[Rcpp::export]]
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="n">LogicalVector&lt;/span> &lt;span class="nf">leading_na&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IntegerVector&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">();&lt;/span>
&lt;span class="n">LogicalVector&lt;/span> &lt;span class="n">leading_na&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">while&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">NA_INTEGER&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">leading_na&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TRUE&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">leading_na&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Rcpp example using NA</title><link>https://bertelsen.ca/post/rcpp-and-na/</link><pubDate>Sun, 28 Aug 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/rcpp-and-na/</guid><description>
&lt;p>Dealing with NA in Rcpp can be a bit tricky to sort out, but the speed boosts are incredible and if you&amp;rsquo;re dealing with large data - worth the time to figure it out. But usage cases are important to consider in the example below you can see that vectorized operations are still very competitive and very concise. Rcpp doesn&amp;rsquo;t shine so much in this example, but it can when you have a problem that requires a waterfall of results (one result relies on the next and so on).&lt;/p>
&lt;p>Here&amp;rsquo;s a basic function that takes NA values into account and basically converts anything &amp;lt; 0 to -1 and anything &amp;gt; 0 to +1.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Rcpp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">microbenchmark&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">signR&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nf">length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">is.na&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x[i]&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">next&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">if &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x[i]&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">x[i]&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="n">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">x[i]&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">-1&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">return&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">signR2&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">x[x&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="n">]&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="n">x[x&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="n">]&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">-1&lt;/span>
&lt;span class="n">x&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">cppFunction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;
&lt;/span>&lt;span class="s">NumericVector signC(NumericVector x) {
&lt;/span>&lt;span class="s">int n = x.size();
&lt;/span>&lt;span class="s">NumericVector out(n);
&lt;/span>&lt;span class="s">
&lt;/span>&lt;span class="s">for(int i = 0; i&amp;lt;n; ++i ) {
&lt;/span>&lt;span class="s"> if (NumericVector::is_na(x[i])) {
&lt;/span>&lt;span class="s"> out[i] = NA_REAL;
&lt;/span>&lt;span class="s"> } else if (x[i] &amp;gt; 0) {
&lt;/span>&lt;span class="s"> out[i] = 1;
&lt;/span>&lt;span class="s"> } else {
&lt;/span>&lt;span class="s"> out[i] = -1;
&lt;/span>&lt;span class="s"> }
&lt;/span>&lt;span class="s"> }
&lt;/span>&lt;span class="s"> return out;
&lt;/span>&lt;span class="s">}&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">test&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">sample&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">rnorm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">25&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="kc">NA&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="m">100000&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">replace&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">microbenchmark&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nf">signR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nf">signR2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nf">signC&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="c1"># Unit: milliseconds&lt;/span>
&lt;span class="c1"># expr min lq mean median uq max neval&lt;/span>
&lt;span class="c1"># signR(test) 197.676873 201.344711 205.951881 202.437384 204.712847 317.973634 100&lt;/span>
&lt;span class="c1"># signR2(test) 4.267238 4.335184 4.424379 4.412983 4.467380 4.869512 100&lt;/span>
&lt;span class="c1"># signC(test) 2.095438 2.120071 2.185537 2.160100 2.219835 2.676364 100&lt;/span>
&lt;span class="nf">all.equal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">signR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="nf">signR2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="nf">signC&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="c1"># TRUE&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Montreal FSA Scraping Part Dieux</title><link>https://bertelsen.ca/post/montreal-scraping-2/</link><pubDate>Mon, 15 Aug 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/montreal-scraping-2/</guid><description>
&lt;p>Although we were able to scrape from the web the FSA we wanted, it was unfortunately not a complete list. Instead, let&amp;rsquo;s try another route using some data that&amp;rsquo;s been crowdsourced, namely the geocoder.ca dataset or a subset provided by aggdata (as the geocoder.ca table is 50mbs and I don&amp;rsquo;t need that level of accuracy).&lt;/p>
&lt;p>Let&amp;rsquo;s install some packages first. You may need to install some system files for this to work:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-shell" data-lang="shell">sudo apt-get install libgeos-dev libgdal1-dev libproj-dev
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now we can install the appropriate packages in R, if they aren&amp;rsquo;t already:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="nf">install.packages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;maptools&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;rgeos&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;rgdal&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now we can run a short script to find the FSA&amp;rsquo;s within the boundaries of our economic region.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ggplot2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">maptools&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rgeos&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rgdal&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># Canadian shapefiles&lt;/span>
&lt;span class="c1"># select your own (https://goo.gl/ztd9HY) or &lt;/span>
&lt;span class="c1"># economic regions (http://goo.gl/YiHMhY) direct download&lt;/span>
&lt;span class="n">shp&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">file.path&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;path/to/ger_000b11a_e.shp&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">map&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">readShapePoly&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">proj4string&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">CRS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;+init=epsg:25832&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">sel&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">map&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">ERNAME&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;Montérégie&amp;#34;&lt;/span>
&lt;span class="c1"># https://www.aggdata.com/download_sample.php?file=ca_postal_codes.csv&lt;/span>
&lt;span class="n">fsa_db&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">read.csv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;https://goo.gl/q97K3L&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fileEncoding&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Windows-1252&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">setNames&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fsa_db&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;fsa&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;place&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;province&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;lat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;long&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">region&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">map[sel&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">]&lt;/span>
&lt;span class="n">points&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">data.frame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nf">as.numeric&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fsa_db&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">lat&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="nf">as.numeric&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fsa_db&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">lat&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">id&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">fsa_db&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">fsa&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stringsAsFactors&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">F&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># We know that Monteregie is in JXX FSAs&lt;/span>
&lt;span class="n">points&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">yes&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">substr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">points&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;J&amp;#34;&lt;/span>
&lt;span class="n">points&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">points[points&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">yes&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">]&lt;/span>
&lt;span class="c1"># Identify if FSA Long/Lat is within Economic Region&lt;/span>
&lt;span class="n">listing&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nf">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nf">nrow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">points&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">p1&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">points[i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="n">]&lt;/span>
&lt;span class="n">sp2&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">SpatialPoints&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">proj4string&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nf">CRS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">proj4string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">region&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;span class="n">listing[[i]]&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">gContains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">region&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sp2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">points&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">points[listing&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="n">unlist&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">]&lt;/span>
&lt;span class="nf">ggplot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">region&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">lat&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">group&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">group&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">+&lt;/span>
&lt;span class="nf">geom_polygon&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fill&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;lightgreen&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">+&lt;/span>
&lt;span class="nf">geom_path&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">colour&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;grey50&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;span class="nf">geom_point&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">points&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">long&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">lat&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">group&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;span class="nf">coord_fixed&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">theme&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">legend.position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Updating Django 1.4 to 1.10 Learnings</title><link>https://bertelsen.ca/post/upgrading-to-django-1-10/</link><pubDate>Mon, 15 Aug 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/upgrading-to-django-1-10/</guid><description>
&lt;p>I had a project that I wrote in Django, 1.4, back in 2012. It&amp;rsquo;s still in production and there are no problems with it. The only exception being that there are planned changes to the database schema. Weighing my options, I decided to move forward with an upgrade to Django 1.10, because migrations are now &amp;ldquo;built-in&amp;rdquo; and data reliability is more important to me than a few extra hours of trouble-shooting the differences between the versions.&lt;/p>
&lt;p>Here are the issues that effected me, when moving from Django 1.4 to 1.10.&lt;/p>
&lt;h3 id="changes-to-settingspy">
&lt;a href="#changes-to-settingspy" class="anchor">
&lt;svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
&lt;path fill-rule="evenodd"
d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
&lt;/path>
&lt;/svg>
&lt;/a>
Changes to settings.py
&lt;/h3>
&lt;p>There are no longer &lt;code>TEMPLATE_*&lt;/code> variables in the &lt;code>settings.py&lt;/code> file you should remove them&lt;/p>
&lt;ul>
&lt;li>The settings file now uses os and you should setup a variable called BASE_DIR&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;span class="n">BASE_DIR&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;/path/to/your/app&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>The TEMPLATES_DIRS now looks very different (example below)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="n">TEMPLATES&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="p">{&lt;/span>
&lt;span class="s1">&amp;#39;BACKEND&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;django.template.backends.django.DjangoTemplates&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;DIRS&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BASE_DIR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;templates&amp;#39;&lt;/span>&lt;span class="p">)],&lt;/span>
&lt;span class="s1">&amp;#39;APP_DIRS&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;OPTIONS&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="s1">&amp;#39;context_processors&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="s1">&amp;#39;django.template.context_processors.debug&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;django.template.context_processors.request&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;django.contrib.auth.context_processors.auth&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s1">&amp;#39;django.contrib.messages.context_processors.messages&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">],&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="p">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>MIDDLEWARE_CLASSES&lt;/code> is now just &lt;code>MIDDLEWARE&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="changes-to-urlspy">
&lt;a href="#changes-to-urlspy" class="anchor">
&lt;svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
&lt;path fill-rule="evenodd"
d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
&lt;/path>
&lt;/svg>
&lt;/a>
Changes to urls.py
&lt;/h3>
&lt;ul>
&lt;li>Some internal packages have changed, patterns no longer exists or is not necessary in django.conf.urls.defaults. There is also a newer element called settings that will need to be&lt;/li>
&lt;li>You also now have to import your other apps directly if you&amp;rsquo;re going to reference them in a single &lt;code>urls.py&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.conf&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">settings&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.conf.urls&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">include&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.contrib.staticfiles&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">views&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.conf.urls.static&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">static&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.contrib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">admin&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.contrib.auth&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">views&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">auth_views&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">credoapp.api&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BCSResource&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ResponseResource&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">your_other_app&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">your_other_app&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">views&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>urlpatterns no longer uses patterns('',&amp;hellip;)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="c1"># Before &lt;/span>
&lt;span class="c1"># urlpatterns = patterns(&amp;#39;&amp;#39;, ...,)`&lt;/span>
&lt;span class="c1"># Now &lt;/span>
&lt;span class="n">urlpatterns&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">,]&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Quotations or ticks surrounding url view definitions are no longer necessary&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="c1"># Before&lt;/span>
&lt;span class="c1"># url(r&amp;#39;^$&amp;#39;, &amp;#39;your_other_app.views.index&amp;#39;, name=&amp;#39;home&amp;#39;)&lt;/span>
&lt;span class="c1"># Now&lt;/span>
&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">your_other_app&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;home&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>The syntax for django.contrib.auth.views.login and .logout is slightly different&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="c1"># Before&lt;/span>
&lt;span class="c1"># url(r&amp;#39;^login/$&amp;#39;, &amp;#39;django.contrib.auth.views.login&amp;#39;, {&amp;#39;template_name&amp;#39;: &amp;#39;login.html&amp;#39;}),&lt;/span>
&lt;span class="c1"># url(r&amp;#39;^logout/$&amp;#39;, &amp;#39;django.contrib.auth.views.logout&amp;#39;, { &amp;#39;next_page&amp;#39;: &amp;#39;/login/&amp;#39;}),&lt;/span>
&lt;span class="c1"># Now&lt;/span>
&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^login/$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">auth_views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">login&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^logout/$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">auth_views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="s1">&amp;#39;next_page&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;/login/&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>django.contrib.auth.views.login&lt;/code> also expects a template for your login page in your templates directory under &lt;code>registration/login.html&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="changes-to-forms">
&lt;a href="#changes-to-forms" class="anchor">
&lt;svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
&lt;path fill-rule="evenodd"
d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
&lt;/path>
&lt;/svg>
&lt;/a>
Changes to Forms
&lt;/h3>
&lt;p>Forms now require fields to be specified, in my case this was really straightforward, I just needed to add &lt;code>fields = '__all__'&lt;/code> to my form classes.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="c1"># Before&lt;/span>
&lt;span class="k">class&lt;/span> &lt;span class="nc">SomeModelForm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">forms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ModelForm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SomeModel&lt;/span>
&lt;span class="c1"># Now&lt;/span>
&lt;span class="k">class&lt;/span> &lt;span class="nc">SomeModelForm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">forms&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ModelForm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SomeModel&lt;/span>
&lt;span class="n">fields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;__all__&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="changes-to-modelspy">
&lt;a href="#changes-to-modelspy" class="anchor">
&lt;svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
&lt;path fill-rule="evenodd"
d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
&lt;/path>
&lt;/svg>
&lt;/a>
Changes to models.py
&lt;/h3>
&lt;ul>
&lt;li>&lt;code>email_re&lt;/code> was removed, in favour of &lt;code>validate_email&lt;/code>. No validation raise error required, &lt;code>validate_email&lt;/code> does this automatically.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="c1"># Before&lt;/span>
&lt;span class="c1"># from django.core.validators import email_re&lt;/span>
&lt;span class="c1"># Now &lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.validators&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">validate_email&lt;/span>
&lt;span class="o">...&lt;/span>
&lt;span class="c1"># Before&lt;/span>
&lt;span class="c1"># email_re.match(email) &lt;/span>
&lt;span class="c1"># Now&lt;/span>
&lt;span class="n">validate_email&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="changes-to-templates-in-general">
&lt;a href="#changes-to-templates-in-general" class="anchor">
&lt;svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
&lt;path fill-rule="evenodd"
d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
&lt;/path>
&lt;/svg>
&lt;/a>
Changes to Templates in General
&lt;/h3>
&lt;ul>
&lt;li>References to urls need to be changed using their namespace (if applicable, not in my case) or using their name.&lt;/li>
&lt;li>References to urls need to be changed using their name, and should be quoted&lt;/li>
&lt;li>These can exist everywhere, recommend using find in files % url to find them all and be methodical!&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-HTML" data-lang="HTML"># Before
# &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{% url someapp.views.view_name kw1 %}
&lt;/span>&lt;span class="s"># Now
&lt;/span>&lt;span class="s">&amp;lt;a href=&amp;#34;&lt;/span>&lt;span class="err">{%&lt;/span> &lt;span class="na">url&lt;/span> &lt;span class="err">&amp;#39;&lt;/span>&lt;span class="na">view_name&lt;/span>&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="na">kw1&lt;/span> &lt;span class="err">%}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Montreal FSA Scraping</title><link>https://bertelsen.ca/post/montreal-scraping/</link><pubDate>Sun, 14 Aug 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/montreal-scraping/</guid><description>
&lt;p>There&amp;rsquo;s no official database that I can find to define clearly some of the economic areas in Montreal, at least none that are free. However, wikipedia does seem to be rather well organized in this regard. Small scale scraping to identify FSAs for a particular locale, in the example below, Montérégie or &amp;ldquo;Rive-Sud&amp;rdquo; an affluent part of the greater Montreal area.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rvest&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">links&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">read_html&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;https://en.wikipedia.org/wiki/South_Shore_(Montreal)&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">html_node&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">css&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;.column-count-3&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">html_nodes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">html_attr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;href&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">links&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;http://en.wikipedia.org&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">links&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">listing&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nf">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">link&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">links&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">listing[[link]]&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">read_html&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">link&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">html_node&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;.adr&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">html_text&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>So far so good, but it looks like a bit of extra cleaning will be required.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">listing&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">unlist&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="n">as.character&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">strsplit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">unlist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">[1]&lt;/span> &lt;span class="s">&amp;#34;J3G to J3H&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J4B&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J4W to J4Z&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J5R&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3L&amp;#34;&lt;/span>
&lt;span class="n">[6]&lt;/span> &lt;span class="s">&amp;#34;J3L&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J6J&amp;#34;&lt;/span> &lt;span class="s">&amp;#34; J6K&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J5B&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J0L1B0&amp;#34;&lt;/span>
&lt;span class="n">[11]&lt;/span> &lt;span class="kc">NA&lt;/span> &lt;span class="s">&amp;#34;J5R&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3Y&amp;#34;&lt;/span> &lt;span class="s">&amp;#34; J3Z&amp;#34;&lt;/span> &lt;span class="s">&amp;#34; J4G to J4N&amp;#34;&lt;/span>
&lt;span class="n">[16]&lt;/span> &lt;span class="s">&amp;#34; J4T&amp;#34;&lt;/span> &lt;span class="s">&amp;#34; J4V&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J4V&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3Y&amp;#34;&lt;/span> &lt;span class="s">&amp;#34; J3Z&amp;#34;&lt;/span>
&lt;span class="n">[21]&lt;/span> &lt;span class="s">&amp;#34; J4T&amp;#34;&lt;/span> &lt;span class="kc">NA&lt;/span> &lt;span class="kc">NA&lt;/span> &lt;span class="s">&amp;#34;J3G 6N9&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3H&amp;#34;&lt;/span>
&lt;span class="n">[26]&lt;/span> &lt;span class="s">&amp;#34;J3H 2M6&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3L&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J0L 1N0&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3N&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3V&amp;#34;&lt;/span>
&lt;span class="n">[31]&lt;/span> &lt;span class="s">&amp;#34;J5A&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J0L 2A0&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3E&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J5C&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J4P&amp;#34;&lt;/span>
&lt;span class="n">[36]&lt;/span> &lt;span class="s">&amp;#34; J4R&amp;#34;&lt;/span> &lt;span class="s">&amp;#34; J4S&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3L 6Z5&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J0L 2K0&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;J3X&amp;#34;&lt;/span>
&lt;span class="n">trim&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">gsub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;^\\s+|\\s+$&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">listing&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">unlist&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="n">as.character&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">strsplit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">unlist&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">strsplit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;to&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="n">unlist&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">na.omit&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="n">trim&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">substr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And we have a list of FSAs for Montérégie pulled from what we hope is a good resource:&lt;/p>
&lt;pre>&lt;code>J3G
J3H
J4B
J4W
J4Z
J5R
J3L
J3L
J6J
J6K
J5B
J0L
J5R
J3Y
J3Z
J4G
J4N
J4T
J4V
J4V
J3Y
J3Z
J4T
J3G
J3H
J3H
J3L
J0L
J3N
J3V
J5A
J0L
J3E
J5C
J4P
J4R
J4S
J3L
J0L
J3X&lt;/code>&lt;/pre></description></item><item><title>TLS for RStudio and Shiny using Let's Encrypt</title><link>https://bertelsen.ca/post/tls-rstudio-shiny/</link><pubDate>Thu, 14 Jul 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/tls-rstudio-shiny/</guid><description>
&lt;p>Below is a very simple way to have https connections for the open source version of RStudio Server and Shiny Server.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-shell" data-lang="shell">sudo apt-get install docker
sudo apt-get install python-pip
sudo pip install docker-compose
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now, in your user directory, create a text file using your preferred text editor, called docker-compose.yml, that looks like the following, keeping in mind that you need to replace: username with your ssh user name, SUB.YOURDOMAIN.COM, and YOUREMAIL. You can also change the docker images.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">nginx&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;80:80&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;443:443&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/etc/nginx/conf.d&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/etc/nginx/vhost.d&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/usr/share/nginx/html&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/username/proxy/certs:/etc/nginx/certs:ro&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">nginx-gen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">jwilder/docker-gen&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-gen&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/var/run/docker.sock:/tmp/docker.sock:ro&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/username/proxy/templates/nginx.tmpl:/etc/docker-gen/templates/nginx.tmpl:ro&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes_from&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">entrypoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/local/bin/docker-gen -notify-sighup nginx -watch -only-exposed -wait 5s:30s /etc/docker-gen/templates/nginx.tmpl /etc/nginx/conf.d/default.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">letsencrypt-nginx-proxy-companion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">jrcs/letsencrypt-nginx-proxy-companion&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">letsencrypt-nginx-proxy-companion&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes_from&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/var/run/docker.sock:/var/run/docker.sock:ro&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/username/proxy/certs:/etc/nginx/certs:rw&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">NGINX_DOCKER_GEN_CONTAINER=nginx-gen&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">rstudio&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rocker/hadleyverse&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rstudio&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;8787:8787&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">VIRTUAL_PORT=8787&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">ROOT=TRUE&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">VIRTUAL_HOST=SUB.YOURDOMAIN.COM&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">USER=rstudio&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">PASSWORD=password&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">LETSENCRYPT_HOST=SUB.YOURDOMAIN.COM&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">LETSENCRYPT_EMAIL=YOUREMAIL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Adding a shiny server is trivial, simply add the following, note that the SUB domain should be different.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">shiny&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rocker/shiny&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">shiny&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">VIRTUAL_HOST=SUB.YOURDOMAIN.COM&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">LETSENCRYPT_EMAIL=YOUREMAIL&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">LETSENCRYPT_HOST=SUB.YOURDOMAIN.COM&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/username/shiny/apps:/srv/shiny-server/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/username/shiny/logs:/var/log/&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">/home/username/shiny/packages:/home/shiny/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now at the command line, type &lt;code>docker-compose up -d&lt;/code> and watch magic happen.&lt;/p></description></item><item><title>Example gitlab-ci.yml for R Projects</title><link>https://bertelsen.ca/post/example-gitlab-ci/</link><pubDate>Mon, 27 Jun 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/example-gitlab-ci/</guid><description>
&lt;p>Most people are running open source projects, so they can easily use github and travis for free. I don&amp;rsquo;t have that luxury, but gitlab has really caught my attention lately. Combining gitlab, gitlab runner with docker makes things very straightforward. Here is an example &lt;code>.gitlab-ci.yml&lt;/code> file that you would need to include in the base directory of your R project to have it run R CMD check and run testthat tests.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rocker/rstudio &lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">test&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">R -e &amp;#39;install.packages(c(&amp;#34;needed here&amp;#34;))&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">R CMD build . --no-build-vignettes --no-manual&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">PKG_FILE_NAME=$(ls -1t *.tar.gz | head -n 1)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">R CMD check &amp;#34;${PKG_FILE_NAME}&amp;#34; --no-build-vignettes --no-manual&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">R -e &amp;#39;devtools::test()&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Radial Plots with Plotly</title><link>https://bertelsen.ca/post/radial-plots-plotly/</link><pubDate>Tue, 14 Jun 2016 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/radial-plots-plotly/</guid><description>
&lt;p>How to make a radial plot without using radial coordinates with plotly.&lt;/p>
&lt;p>Let&amp;rsquo;s load a few libraries and pull some sample data. Then do some preparation by adding data associated with turning the graphic into a circle. A trivial application of high school &lt;a href="https://en.wikipedia.org/wiki/Trigonometry#Mnemonics">SOHCATTOA&lt;/a>, and finally plot. Comments included at each step.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="c1"># Loading ---------------------------------&lt;/span>
&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">plotly&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dplyr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># just because! &lt;/span>
&lt;span class="nf">source&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;https://git.io/vole5&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># load data&lt;/span>
&lt;span class="c1"># Data Preperation ------------------------&lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">seq&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">345&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 24 responses, equals 15 degrees per response &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">Proportion&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">sin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># SOH &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">a&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">Proportion&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">cos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># CAH &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">o100&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">sin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># Outer ring x &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">a100&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">cos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># Outer ring y &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">a75&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">0.75&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">cos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 75% ring y &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">o75&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">0.75&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">sin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 75% ring x &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">o50&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">0.5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">sin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 50% ring x &lt;/span>
&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">a50&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">0.5&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nf">cos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">theta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kc">pi&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="m">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 50% ring y&lt;/span>
&lt;span class="c1"># Plot ------------------------------------&lt;/span>
&lt;span class="n">p&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">plot_ly&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1"># Wire-frame lines from origin&lt;/span>
&lt;span class="nf">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">24&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">p&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">add_trace&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">p&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">o100[i]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">a100[i]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">evaluate&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;#d3d3d3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;3px&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">showlegend&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">p&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="c1"># Add lines &lt;/span>
&lt;span class="nf">add_trace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="nf">[c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">48&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">25&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="n">]&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">o&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Year&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">mode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;lines+markers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">hoverinfo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;text&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">text&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">paste&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Year&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Response&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nf">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Proportion&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="m">100&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s">&amp;#34;%&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="c1"># Add 100% circle &lt;/span>
&lt;span class="nf">add_trace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">o100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a100&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">text&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Response&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">hoverinfo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">textposition&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;top middle&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;lines+text&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;#d3d3d3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;3px&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shape&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;spline&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">showlegend&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="c1"># Add 50% circle&lt;/span>
&lt;span class="nf">add_trace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">o50&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a50&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;lines&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;#d3d3d3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;3px&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shape&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;spline&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">hoverinfo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">showlegend&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="c1"># Add 75% circle &lt;/span>
&lt;span class="nf">add_trace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">o75&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">a75&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;lines&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;#d3d3d3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;3px&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shape&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;spline&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">hoverinfo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;none&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">showlegend&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">layout&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">autosize&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">hovermode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;closest&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">autoscale&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">800&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">height&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">800&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">xaxis&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">range&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">-1.25&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">1.25&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">showticklabels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">zeroline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">showgrid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">yaxis&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">range&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">-1.25&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">1.25&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">showticklabels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">zeroline&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">showgrid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">FALSE&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Boostrap with logistic regression</title><link>https://bertelsen.ca/post/bootstrapping-logistic/</link><pubDate>Sat, 01 Aug 2015 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/bootstrapping-logistic/</guid><description>
&lt;p>A quick example of bootstraping a logistic regression. Nothing special here, example could be extended to any other type of model that has a &lt;code>coef()&lt;/code> method.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">boot&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">logit_test&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">indices&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">d&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">d[indices&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">]&lt;/span>
&lt;span class="n">fit&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">glm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">your&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">formula&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">family&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;binomial&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">return&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">coef&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">boot_fit&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">boot&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">your_data&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">statistic&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">logit_test&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">R&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1e5&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Expand strsplit to data.frame</title><link>https://bertelsen.ca/post/expand-vector-to-df/</link><pubDate>Mon, 15 Jun 2015 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/expand-vector-to-df/</guid><description>
&lt;p>Take a vector, with some seperator (i.e., ;), vec and expand it into a data.frame, filling in NA positions:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-R" data-lang="R">&lt;span class="n">vec&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">strsplit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">as.character&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vec&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s">&amp;#34;;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">df&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">rbind.fill&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nf">lapply&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">tmp&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">data.frame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">t&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="n">df&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">as.data.frame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">df&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Installing a newer version of gdal on Ubuntu 20.04</title><link>https://bertelsen.ca/post/gdal-3-3-1-on-ubuntu/</link><pubDate>Mon, 15 Jun 2015 00:00:00 +0000</pubDate><author>Brandon Erik Bertelsen</author><guid>https://bertelsen.ca/post/gdal-3-3-1-on-ubuntu/</guid><description>
&lt;p>The installation candidate for GDAL for Ubuntu 20.04 is quite old. The mapviews team has come up with some rather good new features that rely on v3.3.1 or newer.&lt;/p>
&lt;p>First, use the PPA from ubuntugis-unstable:&lt;/p>
&lt;pre>&lt;code class="language-{shell}" data-lang="{shell}">sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable
# enter
sudo apt-get update
&lt;/code>&lt;/pre>&lt;p>You must purge existing versions of gdal-bin, libkml, and libgdal on your machine. Note that your version numbers may vary (libgdal29, for example, may be something else)&lt;/p>
&lt;pre>&lt;code class="language-{shell}" data-lang="{shell}">sudo apt-get purge --auto-remove libgdal
sudo apt-get purge --auto-remove libgdal29
sudo apt-get purge --auto-remove gdal-bin
sudo apt-get purge --auto-remove libkml-dev
sudo apt-get purge --auto-remove libproj-dev
sudo find /usr/local/bin/ -name 'gdal*' -delete
sudo find /usr/local/lib/ -name 'libgdal*' -delete
&lt;/code>&lt;/pre>&lt;p>Install the version of the package from unstable ppa.&lt;/p>
&lt;pre>&lt;code class="language-{shell}" data-lang="{shell}">sudo apt-get install libgdal-dev gdal-bin libproj15 libproj19 libproj-dev
&lt;/code>&lt;/pre>&lt;p>Now there are some problems with the libs from the unstable package but they are fairly straightforward to figure out. THe main issue is that some of the libs point to older versions of themselves or point to themselves in the wrong place.&lt;/p>
&lt;p>When attempting to install &lt;code>sf&lt;/code> in R using &lt;code>install.packages('sf')&lt;/code> you may encounter the following error:&lt;/p>
&lt;pre>&lt;code>unable to load shared object '/usr/local/lib/R/site-library/terra/libs/terra.so': libproj.so.12: cannot open shared object file: No such file or directory
&lt;/code>&lt;/pre>&lt;p>This is telling you that for whatever reason it can not find libproj.so.12. You can correct this by creating a symbolic link between the version of libproj you are actually using and this older one. In my case, this was libproj15&lt;/p>
&lt;pre>&lt;code>sudo ln -s /usr/lib/x86_64-linux-gnu/libproj.so.15 /usr/lib/libproj.so.12
&lt;/code>&lt;/pre>&lt;p>You may experience any number of these &amp;ldquo;can&amp;rsquo;t find the lib durrrr&amp;rdquo; kind of problems. In my experience they were solved by first finding the actual lib available on my system and then symlinking them to the version desired by the R packages installation process.&lt;/p>
&lt;p>In my case, the R package installation was looking in &lt;code>/usr/lib/&lt;/code> but it was actually in &lt;code>/usr/lib/x86_64-linux-gnu/&lt;/code>. You don&amp;rsquo;t need to remember this, you can check for yourself with the following:&lt;/p>
&lt;pre>&lt;code>$ dpkg -L libproj15
/.
/usr
/usr/lib
/usr/lib/x86_64-linux-gnu
/usr/lib/x86_64-linux-gnu/libproj.so.15.3.1
/usr/share
/usr/share/doc
/usr/share/doc/libproj15
/usr/share/doc/libproj15/AUTHORS
/usr/share/doc/libproj15/NEWS.Debian.gz
/usr/share/doc/libproj15/NEWS.gz
/usr/share/doc/libproj15/README.gz
/usr/share/doc/libproj15/changelog.Debian.gz
/usr/share/doc/libproj15/copyright
/usr/lib/x86_64-linux-gnu/libproj.so.15
&lt;/code>&lt;/pre>&lt;p>Looking at the end there we see the lib. Just remember that creating the symlink is in the form &lt;code>sudo ln -s source target&lt;/code>. Where source is what you would find in &lt;code>dpkg -L your_lib&lt;/code> and target is what the R installation process complains about missing.&lt;/p></description></item></channel></rss>
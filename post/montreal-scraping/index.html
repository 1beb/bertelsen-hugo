<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>Montreal FSA Scraping | @beb</title><meta property="og:site_name" content><meta property="og:title" content="Montreal FSA Scraping | @beb"><meta itemprop=name content="Montreal FSA Scraping | @beb"><meta name=twitter:title content="Montreal FSA Scraping | @beb"><meta name=application-name content="Montreal FSA Scraping | @beb"><meta name=description content><meta name=twitter:description content><meta itemprop=description content><meta property="og:description" content><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="2016-08-14T00:00:00Z"><meta property="article:published_time" content="2016-08-14T00:00:00Z"><meta property="og:article:author" content="Brandon erik bertelsen"><meta property="article:author" content="Brandon erik bertelsen"><meta name=author content="Brandon erik bertelsen"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Montreal FSA Scraping","author":{"@type":"Person","name":""},"datePublished":"2016-08-14","description":"","wordCount":306,"mainEntityOfPage":"True","dateModified":"2016-08-14","publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":"https:\/\/bertelsen.ca\/favicon.ico"}}}</script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.85d2dd3a54e29956009c7c48e5f5d4bc22b6af329dc58a4fc8919e8c12720daa.css></head><script>(function(){const b='ThemeColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.userColorScheme='dark':document.documentElement.dataset.userColorScheme='light'})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/>@beb</a></div><div class=flex><a href=/about/>About</a>
<a href=/articles/>Notes</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Montreal FSA Scraping</h1><div class=post-meta><div>By Brandon Erik Bertelsen | <time>August 14, 2016</time>
| 2 minutes</div><div class=tags></div></div></div></div></header></article><div class=article-post><p>There&rsquo;s no official database that I can find to define clearly some of the economic areas in Montreal, at least none that are free. However, wikipedia does seem to be rather well organized in this regard. Small scale scraping to identify FSAs for a particular locale, in the example below, Montérégie or &ldquo;Rive-Sud&rdquo; an affluent part of the greater Montreal area.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-R data-lang=R><span class=nf>library</span><span class=p>(</span><span class=n>rvest</span><span class=p>)</span>  
<span class=n>links</span> <span class=o>&lt;-</span> <span class=nf>read_html</span><span class=p>(</span><span class=s>&#34;https://en.wikipedia.org/wiki/South_Shore_(Montreal)&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>  
  <span class=nf>html_node</span><span class=p>(</span><span class=n>css</span> <span class=o>=</span> <span class=s>&#34;.column-count-3&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=nf>html_nodes</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=nf>html_attr</span><span class=p>(</span><span class=s>&#34;href&#34;</span><span class=p>)</span>

<span class=n>links</span> <span class=o>&lt;-</span> <span class=nf>paste0</span><span class=p>(</span><span class=s>&#34;http://en.wikipedia.org&#34;</span><span class=p>,</span><span class=n>links</span><span class=p>)</span>  
<span class=n>listing</span> <span class=o>&lt;-</span> <span class=nf>list</span><span class=p>()</span>  
<span class=nf>for</span><span class=p>(</span><span class=n>link</span> <span class=n>in</span> <span class=n>links</span><span class=p>)</span> <span class=p>{</span>  
  <span class=n>listing[[link]]</span> <span class=o>&lt;-</span> <span class=nf>read_html</span><span class=p>(</span><span class=n>link</span><span class=p>)</span> <span class=o>%&gt;%</span> <span class=nf>html_node</span><span class=p>(</span><span class=s>&#34;.adr&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span> <span class=nf>html_text</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>So far so good, but it looks like a bit of extra cleaning will be required.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-R data-lang=R><span class=o>&gt;</span> <span class=n>listing</span> <span class=o>%&gt;%</span> <span class=nf>unlist</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=n>as.character</span> <span class=o>%&gt;%</span> <span class=nf>strsplit</span><span class=p>(</span><span class=s>&#34;,&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span> <span class=nf>unlist</span><span class=p>()</span>
 <span class=n>[1]</span> <span class=s>&#34;J3G to J3H&#34;</span>  <span class=s>&#34;J4B&#34;</span>         <span class=s>&#34;J4W to J4Z&#34;</span>  <span class=s>&#34;J5R&#34;</span>         <span class=s>&#34;J3L&#34;</span>        
 <span class=n>[6]</span> <span class=s>&#34;J3L&#34;</span>         <span class=s>&#34;J6J&#34;</span>         <span class=s>&#34; J6K&#34;</span>        <span class=s>&#34;J5B&#34;</span>         <span class=s>&#34;J0L1B0&#34;</span>     
<span class=n>[11]</span> <span class=kc>NA</span>            <span class=s>&#34;J5R&#34;</span>         <span class=s>&#34;J3Y&#34;</span>         <span class=s>&#34; J3Z&#34;</span>        <span class=s>&#34; J4G to J4N&#34;</span>
<span class=n>[16]</span> <span class=s>&#34; J4T&#34;</span>        <span class=s>&#34; J4V&#34;</span>        <span class=s>&#34;J4V&#34;</span>         <span class=s>&#34;J3Y&#34;</span>         <span class=s>&#34; J3Z&#34;</span>       
<span class=n>[21]</span> <span class=s>&#34; J4T&#34;</span>        <span class=kc>NA</span>            <span class=kc>NA</span>            <span class=s>&#34;J3G 6N9&#34;</span>     <span class=s>&#34;J3H&#34;</span>        
<span class=n>[26]</span> <span class=s>&#34;J3H 2M6&#34;</span>     <span class=s>&#34;J3L&#34;</span>         <span class=s>&#34;J0L 1N0&#34;</span>     <span class=s>&#34;J3N&#34;</span>         <span class=s>&#34;J3V&#34;</span>        
<span class=n>[31]</span> <span class=s>&#34;J5A&#34;</span>         <span class=s>&#34;J0L 2A0&#34;</span>     <span class=s>&#34;J3E&#34;</span>         <span class=s>&#34;J5C&#34;</span>         <span class=s>&#34;J4P&#34;</span>        
<span class=n>[36]</span> <span class=s>&#34; J4R&#34;</span>        <span class=s>&#34; J4S&#34;</span>        <span class=s>&#34;J3L 6Z5&#34;</span>     <span class=s>&#34;J0L 2K0&#34;</span>     <span class=s>&#34;J3X&#34;</span>     
<span class=n>trim</span> <span class=o>&lt;-</span> <span class=nf>function </span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=nf>gsub</span><span class=p>(</span><span class=s>&#34;^\\s+|\\s+$&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>  
<span class=n>listing</span> <span class=o>%&gt;%</span>  
  <span class=nf>unlist</span><span class=p>()</span> <span class=o>%&gt;%</span> 
  <span class=n>as.character</span> <span class=o>%&gt;%</span> 
  <span class=nf>strsplit</span><span class=p>(</span><span class=s>&#34;,&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=nf>unlist</span><span class=p>()</span> <span class=o>%&gt;%</span> 
  <span class=nf>strsplit</span><span class=p>(</span><span class=s>&#34;to&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=n>unlist</span> <span class=o>%&gt;%</span> 
  <span class=nf>na.omit</span><span class=p>()</span> <span class=o>%&gt;%</span> 
  <span class=n>trim</span> <span class=o>%&gt;%</span> 
  <span class=nf>substr</span><span class=p>(</span><span class=n>start</span> <span class=o>=</span> <span class=m>0</span><span class=p>,</span> <span class=n>stop</span> <span class=o>=</span> <span class=m>3</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>And we have a list of FSAs for Montérégie pulled from what we hope is a good resource:</p><pre><code>J3G  
J3H  
J4B  
J4W  
J4Z  
J5R  
J3L  
J3L  
J6J  
J6K  
J5B  
J0L  
J5R  
J3Y  
J3Z  
J4G  
J4N  
J4T  
J4V  
J4V  
J3Y  
J3Z  
J4T  
J3G  
J3H  
J3H  
J3L  
J0L  
J3N  
J3V  
J5A  
J0L  
J3E  
J5C  
J4P  
J4R  
J4S  
J3L  
J0L  
J3X</code></pre></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/post/tls-rstudio-shiny/ title="Previous post (older)"><span>Previous</span>
TLS for RStudio and Shiny using Let's Encrypt</a>
<a rel=next href=/post/upgrading-to-django-1-10/ title="Next post (newer)"><span>Next</span>
Updating Django 1.4 to 1.10 Learnings</a></nav></div><div class=container></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links></nav></section><script defer src=/ts/features.39c567b3af1363f8abe74bfd650f3d58cb963716b7ad4b3b53f801d3ca585599.js data-enable-footnotes=true></script></footer></body></html>